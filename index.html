from pathlib import Path
import zipfile

root = Path("/mnt/data/entropylab-clean")
root.mkdir(parents=True, exist_ok=True)
index_path = root / "index.html"

with open(index_path, "w", encoding="utf-8") as f:
    f.write("""<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EntropyLab â€” ì—”íŠ¸ë¡œí”¼ ë°°ìš°ê¸°</title>
  <style>
    :root { --bg:#0b1020; --panel:#0f172a; --text:#e2e8f0; --muted:#94a3b8; --accent:#22d3ee; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; background:linear-gradient(180deg,#0a0f1e,#0e1530); color:var(--text); }
    header{ position:sticky; top:0; background:rgba(11,16,32,.7); backdrop-filter: blur(10px); border-bottom:1px solid #1f2937; z-index:10; }
    .wrap{ max-width:1100px; margin:0 auto; padding:14px 16px; }
    nav{ display:flex; gap:12px; }
    nav a{ color:var(--muted); text-decoration:none; padding:6px 10px; border-radius:8px; }
    nav a:hover{ background:#111827; color:var(--text); }
    main{ padding:20px 16px; }
    .card{ background:linear-gradient(180deg,#0b1120,#0a1226); border:1px solid #111827; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); margin-bottom:16px; }
    .inner{ padding:16px; }
    h1,h2{ margin:0 0 8px; }
    .muted{ color:var(--muted); }
    .row{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .kbd{ font-size:12px; border:1px solid #1f2937; background:#0b1226; padding:6px 10px; border-radius:8px; color:var(--text); }
    button{ cursor:pointer; border:1px solid #1f2937; background:#0b1226; color:var(--text); padding:10px 12px; border-radius:12px; font-weight:600 }
    button.primary{ background:linear-gradient(180deg,#0f172a,#0b1226); border-color:#233045; box-shadow:0 8px 20px rgba(34,211,238,.12) }
    .page{ display:none; opacity:0; transform: translateY(6px); transition:opacity .2s ease, transform .2s ease; }
    .page.active{ display:block; opacity:1; transform:none; }
    .pagebar{ position:sticky; bottom:12px; display:flex; justify-content:space-between; align-items:center; gap:12px; background:rgba(11,16,32,.75); border:1px solid #111827; border-radius:12px; padding:8px 12px; }
    .dots{ display:flex; gap:8px; }
    .dot{ width:8px; height:8px; border-radius:50%; background:#1f2937; display:inline-block; }
    .dot.active{ background:var(--accent); }
    .pagecount{ font-size:12px; color:var(--muted); }
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <strong>EntropyLab</strong>
      <nav>
        <a href="#page-cover" data-goto="0">í‘œì§€</a>
        <a href="#page-intro" data-goto="1">ì†Œê°œ</a>
        <a href="#page-sim" data-goto="2">ì‹œë®¬ë ˆì´í„°</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="card page" id="page-cover" aria-label="í‘œì§€">
      <div class="inner">
        <h1>EntropyLab</h1>
        <p class="muted">ì—”íŠ¸ë¡œí”¼ë¥¼ ì‰½ê³  ì¬ë¯¸ìˆê²Œ â€” í‘œì§€ â†’ ì†Œê°œ â†’ ì‹œë®¬ë ˆì´í„° ìˆœì„œë¡œ ì‚´í´ë³´ì„¸ìš”.</p>
        <div class="row">
          <button class="primary" id="startBtn">ì‹œì‘í•˜ê¸° â†’</button>
          <a class="kbd" href="#page-intro" data-goto="1" role="button">ê°œë… ì†Œê°œë¡œ</a>
        </div>
      </div>
    </section>

    <section class="card page" id="page-intro" aria-label="ì—”íŠ¸ë¡œí”¼ ì†Œê°œ">
      <div class="inner">
        <h2>&lt;ì—´ì—­í•™ ë²•ì¹™ ê°„ë‹¨ ì •ë¦¬&gt;</h2>
        <ul>
          <li><strong>ì—´ì—­í•™ ì œ 1ë²•ì¹™</strong>: ì—ë„ˆì§€ì˜ ì´ëŸ‰ì€ í•­ìƒ ì¼ì •í•˜ë©° í•œ í˜•íƒœì—ì„œ ë‹¤ë¥¸ í˜•íƒœë¡œ ë³€í™˜ë  ë¿ ìƒì„±ë˜ê±°ë‚˜ ì†Œë©¸ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì›ë¦¬</li>
          <li><strong>ì—´ì—­í•™ ì œ 2ë²•ì¹™</strong>: ì´ëŠ” ì—”íŠ¸ë¡œí”¼ê°€ ë‚˜íƒ€ë‚˜ëŠ” ë²•ì¹™ì´ë‹¤. ìì—°ê³„ì˜ ëª¨ë“  ìë°œì  ê³¼ì •ì€ ë¬´ì§ˆì„œë„, ì¦‰ ì—”íŠ¸ë¡œí”¼ê°€ ì¦ê°€í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì§„í–‰ëœë‹¤ëŠ” ë²•ì¹™ì…ë‹ˆë‹¤. ì¦‰, ì—´ì€ í•­ìƒ ë†’ì€ ì˜¨ë„ì—ì„œ ë‚®ì€ ì˜¨ë„ë¡œ ìë°œì ìœ¼ë¡œ íë¥´ë©°, ì™¸ë¶€ì˜ ì¼ì´ ì—†ì´ëŠ” ì €ì˜¨ì—ì„œ ê³ ì˜¨ìœ¼ë¡œ íë¥¼ ìˆ˜ ì—†ë‹¤.</li>
        </ul>
        <p>ex) ì–¼ìŒì´ ë¬¼ì´ ë  ë•Œ ë¬¼ ë¶„ìê°€ ì´ë™í•˜ê²Œ ë˜ëŠ”ë°, ì´ ë•Œ ë¶„ìë“¤ì´ ë‹¤ì–‘í•œ ë°©í–¥ìœ¼ë¡œ í¼ì§€ê²Œ ë˜ë©° ì´ë¡œ ì¸í•´ì„œ ì—”íŠ¸ë¡œí”¼ê°€ ì¦ê°€í•˜ê²Œ ëœë‹¤. (ë¬´ì§ˆì„œí•¨ì´ ì¦ê°€í•˜ê²Œ ë¨)</p>
        <p>=&gt; ì´ëŸ¬í•œ ì˜ˆì‹œë¡œ í•˜ë‚˜ì˜ ê°œë…ì„ ë” ì•Œ ìˆ˜ ìˆëŠ”ë°, ì–¼ìŒì´ ë¬¼ì´ ë˜ëŠ” ê²ƒì€ ê³ ì²´ì—ì„œ ì•¡ì²´ê°€ ë˜ëŠ” ê²ƒì¸ë° ì´ ê³¼ì •ì—ì„œ ì™¸ë¶€ì˜ ë‹¤ë¥¸ í˜ ì—†ì´ ì•¡ì²´ê°€ ë‹¤ì‹œ ê³ ì²´ê°€ ë˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— í•œ ê³µê°„ì—ì„œ ì—”íŠ¸ë¡œí”¼ ê°’ì€ ê°ì†Œí•˜ì§€ ì•Šê³  ê³„ì†í•´ì„œ ì¦ê°€í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>
      </div>
      <div class="inner">
        <h2>ì´ë¡ ì  ë°°ê²½</h2>
        <p>ì—”íŠ¸ë¡œí”¼ì˜ ê°œë…: ë¬¼ì§ˆ ë˜ëŠ” ì—ë„ˆì§€ì˜ ë¬´ì§ˆì„œí•œ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ”ë°, ì •í™•í•˜ê²ŒëŠ” ë¬¼ì§ˆì´ë‚˜ ì—ë„ˆì§€ ìƒíƒœê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ê²½ìš°ì˜ ìˆ˜ë¡œì„œì˜ í™•ë¥ ì„ ë‚˜íƒ€ë‚¸ë‹¤.</p>
      </div>
      <div class="inner">
        <h2>#ì—”íŠ¸ë¡œí”¼ì˜ ì¢…ë¥˜</h2>
        <p>ì—”íŠ¸ë¡œí”¼ì˜ ì¢…ë¥˜ì—ëŠ” ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆëŠ”ë°, ì—´ì—­í•™ì  ì—”íŠ¸ë¡œí”¼, í†µê³„í•™ì  ì—”íŠ¸ë¡œí”¼(ë³¼ì¸ ë§Œ ì—”íŠ¸ë¡œí”¼), ì •ë³´ ì—”íŠ¸ë¡œí”¼ê°€ ìˆë‹¤.</p>
        <p>ì²« ë²ˆì§¸ë¡œ ì—´ì—­í•™ì  ì—”íŠ¸ë¡œí”¼ëŠ” ë¬¼ì²´ì˜ ì—´ì  ìƒíƒœë¥¼ ë‚˜íƒ€ë‚¸ ë¬¼ë¦¬ëŸ‰ìœ¼ë¡œ, ë¬´ì§ˆì„œë„ë¼ê³  ì•Œë ¤ì ¸ìˆë‹¤.</p>
        <p>ë‘ ë²ˆì§¸ë¡œ í†µê³„í•™ì  ì—”íŠ¸ë¡œí”¼ëŠ” ë³¼ì¸ ë§Œ ì—”íŠ¸ë¡œí”¼ë¼ê³  ë¶ˆë¦¬ë©° ì´ëŠ” ì—´ì—­í•™ì  ì—”íŠ¸ë¡œí”¼ì˜ ê·¼ë³¸ì ì¸ ì •ì˜ê°€ ë˜ê³  ê³„ì˜ ê±°ì‹œì  ìƒíƒœì— ëŒ€ì‘í•˜ëŠ” ë¯¸ì‹œì  ìƒíƒœì˜ ìˆ˜ë¥¼ ë¡œê·¸ë¡œ ì •ì˜í•œ ê°’ì¸ë°, ì´ ê°’ì€ í•œ ê³µê°„ì—ì„œ ì—´ì˜ ì´ë™ëŸ‰ì„ ì ˆëŒ€ ì˜¨ë„ë¡œ ë‚˜ëˆˆ ê°’ê³¼ ê°™ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ë‘ ê°œì˜ ê³µê°„(A, B ê³µê°„)ì´ ìˆë‹¤ê³  ì¹˜ì. ì´ ë•Œ, ê°ê° ê³µê°„ì—ì„œì˜ ì ˆëŒ€ ì˜¨ë„ê°€ ê°ê° 350, 300ì´ë¼ê³  ê°€ì •í–ˆì„ ë•Œ A ê³µê°„ì—ì„œ B ê³µê°„ìœ¼ë¡œ ì—ë„ˆì§€ê°€ 70ë§Œí¼ ì´ë™ í–ˆì„ ë•Œ Aê³µê°„ì—ì„œì˜ ì´ë™ëŸ‰ì€ -70ì´ ë˜ê³  ì´ë¡œ ì¸í•´ A ê³µê°„ì—ì„œì˜ í†µê³„í•™ì  ì—”íŠ¸ë¡œí”¼ëŠ” -5ë¶„ì˜ 1ì´ ë˜ê³ , Bê³µê°„ì—ì„œ ì´ë™ëœ ì—ë„ˆì§€ì˜ ì–‘ì€ +70ì´ ë˜ê¸° ë•Œë¬¸ì— Bê³µê°„ì—ì„œì˜ ì—”íŠ¸ë¡œí”¼ ê°’ì€ +30ë¶„ì˜ 7ì´ ëœë‹¤.</p>
        <p>ì„¸ ë²ˆì§¸ë¡œ ì •ë³´ ì—”íŠ¸ë¡œí”¼ëŠ” ì •ë³´ì˜ ë¶ˆí™•ì‹¤ì„± ë˜ëŠ” ì •ë³´ëŸ‰ì˜ ê¸°ëŒ€ê°’, ì¦‰ í‰ê· ê°’ì„ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì´ë‹¤.</p>
        <p><strong>ì´ ì¤‘ ìš°ë¦¬ê°€ ì—°êµ¬í•  ì£¼ì œëŠ” â€œí†µê³„í•™ì  ì—”íŠ¸ë¡œí”¼â€ë¥¼ í™œìš©í•˜ì—¬ ê¸°ì²´ ë¶„ìì˜ ì´ë™ì„ í™•ì¸í•˜ë©° ì—”íŠ¸ë¡œí”¼ì˜ ì¦ê°€ê°’ì„ ì‹œê°í™”í•˜ì—¬ í™•ì¸í•˜ëŠ” ê²ƒì´ë‹¤.</strong></p>
      </div>
    </section>

    <section class="card page" id="page-sim" aria-label="ì—”íŠ¸ë¡œí”¼ ì‹œë®¬ë ˆì´ì…˜">
      <style>
        :root { --bg2: #0f1220; --panel2:#171a2b; --text2:#e6e8ef; --muted2:#9aa0b4; --accent2:#78a8ff; --red:#ff4d4d; --blue:#4d9bff; --green:#51d19a; --yellow:#ffd166; }
        #simScope * { box-sizing: border-box; }
        #simScope .wrap2 { max-width: 1100px; margin: 0 auto; padding: 0; }
        #simScope h1 { font-size: 20px; margin: 0 0 8px; letter-spacing:.2px }
        #simScope .sub { color: var(--muted2); margin-bottom: 16px; }
        #simScope .grid { display: grid; grid-template-columns: 1.2fr .8fr; gap: 16px; }
        #simScope .card2 { background: var(--panel2); border-radius: 16px; padding: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
        #simScope .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        #simScope .row > * { margin: 4px 0; }
        #simScope label { font-size: 12px; color: var(--muted2); }
        #simScope input[type=range] { width: 180px; }
        #simScope button { background: #222742; color: var(--text2); border: 1px solid #30365c; padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; }
        #simScope button:hover { background: #283059; }
        #simScope .pill { padding: 6px 10px; border-radius: 999px; background: #1e2444; border:1px solid #2a315e; font-size: 12px; color: var(--text2); }
        #simScope .legend { display:flex; align-items:center; gap:8px; }
        #simScope .dot { width:10px; height:10px; border-radius:50%; display:inline-block; }
        #simScope .stat { font-variant-numeric: tabular-nums; font-weight:600; color: var(--text2); }
        #simScope canvas { display:block; width:100%; height:auto; border-radius: 12px; background: #0b0e1a; }
        #simScope .small { font-size: 12px; color: var(--muted2); }
        #simScope .side { display: grid; grid-template-rows: auto auto auto auto 1fr; gap: 12px; }
        #simScope .meterWrap { background:#0b0e1a; border:1px solid #283059; border-radius:12px; height: 10px; overflow:hidden; }
        #simScope .meterBar { height:100%; width:0%; background: linear-gradient(90deg, var(--green), var(--yellow)); }
        #simScope .sep { height:1px; background:#2a315e; margin:12px 0; }
        @media (max-width: 960px){ #simScope .grid{ grid-template-columns: 1fr; } }
      </style>
      <div id="simScope" class="inner">
        <div class="wrap2">
          <h1>ì—”íŠ¸ë¡œí”¼ í˜¼í•© ì‹œë®¬ë ˆì´í„° (ë¹¨ê°•/íŒŒë‘, 2ì¹¸ ëª¨ë¸)</h1>
          <div class="sub">ì²˜ìŒì—” ì™¼ìª½ì— ë¹¨ê°•, ì˜¤ë¥¸ìª½ì— íŒŒë‘ ì…ìë¥¼ ë‘ê³  ì¤‘ì•™ì˜ ì‘ì€ ë¬¸(ê°œêµ¬)ë§Œ í†µí•´ ì„œë¡œ ì„ì…ë‹ˆë‹¤. ì¡°í•©ë¡ ì  ë³¼ì¸ ë§Œ ì—”íŠ¸ë¡œí”¼ <code>S = k ln W</code> (ì—¬ê¸°ì„  <code>k=1</code>)ì™€ ì—´ì˜ ì´ë™ ê¸°ë°˜ ì—”íŠ¸ë¡œí”¼ <code>âˆ‘ Î”Q/T</code>ë¥¼ í•¨ê»˜ ë´…ë‹ˆë‹¤.</div>
          <div class="grid">
            <div class="card2">
              <canvas id="sim" width="900" height="420"></canvas>
              <div class="row" style="justify-content:space-between; margin-top:10px">
                <div class="row">
                  <span class="legend"><span class="dot" style="background:var(--red)"></span><span class="small">ë¹¨ê°•:</span> <span id="rLeft" class="stat">0</span>L / <span id="rRight" class="stat">0</span>R</span>
                  <span class="legend" style="margin-left:12px"><span class="dot" style="background:var(--blue)"></span><span class="small">íŒŒë‘:</span> <span id="bLeft" class="stat">0</span>L / <span id="bRight" class="stat">0</span>R</span>
                  <span class="pill">ë¬¸ ë†’ì´: <span id="gatePerc">40</span>%</span>
                </div>
                <div class="row">
                  <button id="toggle">â¯ï¸ ì¼ì‹œì •ì§€</button>
                  <button id="reset">ğŸ”„ ë¦¬ì…‹</button>
                </div>
              </div>
            </div>

            <div class="side">
              <div class="card2">
                <div class="row" style="justify-content:space-between">
                  <div>
                    <div class="small">ë³¼ì¸ ë§Œ ì—”íŠ¸ë¡œí”¼ S(t) / S<sub>max</sub></div>
                    <div class="meterWrap"><div id="meter" class="meterBar"></div></div>
                  </div>
                  <div class="stat">í˜„ì¬: <span id="Snow">0.000</span></div>
                </div>
                <div class="sep"></div>
                <canvas id="chart" width="480" height="220"></canvas>
                <div class="small">ë…¹ìƒ‰ ì„ : S(t) / S<sub>max</sub>. ìµœëŒ€ëŠ” ê° ìƒ‰ ì…ìê°€ ì¢Œ/ìš° ë°˜ì”©ì¼ ë•Œì…ë‹ˆë‹¤.</div>
              </div>

              <div class="card2" id="heatCard">
                <div class="row" style="justify-content:space-between; align-items:flex-start">
                  <div>
                    <div class="small">ì˜¨ë„ ì¶”ì • (k<sub>B</sub>=1, m=1, 2D: âŸ¨KEâŸ©=kT â‡’ T=âŸ¨0.5vÂ²âŸ©)</div>
                    <div class="row">
                      <span class="pill">ì™¼ìª½ T<sub>L</sub>: <span id="TL">0.000</span></span>
                      <span class="pill">ì˜¤ë¥¸ìª½ T<sub>R</sub>: <span id="TR">0.000</span></span>
                    </div>
                  </div>
                  <div>
                    <div class="small">ì—´ ì—”íŠ¸ë¡œí”¼(ëˆ„ì )</div>
                    <div class="row">
                      <span class="pill">Î”S<sub>Q</sub>: <span id="SQ">0.000</span></span>
                      <span class="pill">Q<sub>L</sub>: <span id="QL">0.000</span></span>
                      <span class="pill">Q<sub>R</sub>: <span id="QR">0.000</span></span>
                    </div>
                  </div>
                </div>
                <div class="small" style="margin-top:6px">ì…ìê°€ ë¬¸ì„ í†µê³¼í•  ë•Œ ìš´ë™ì—ë„ˆì§€ë¥¼ í•´ë‹¹ ì¹¸ìœ¼ë¡œ ì „ë‹¬ëœ ì—´ë¡œ ë³´ê³  Î”S=Î£(Î”Q/T)ë¡œ ëˆ„ì í•©ë‹ˆë‹¤.</div>
              </div>

              <div class="card2" id="tempControls">
                <div class="row" style="justify-content:space-between">
                  <div class="row">
                    <label>ì™¼ìª½ ì´ˆê¸° ì˜¨ë„ T<sub>L0</sub></label>
                    <input id="TL0Input" type="range" min="0.2" max="5.0" step="0.1" value="1.0" />
                    <span class="stat" id="TL0Label">1.0</span>
                  </div>
                  <div class="row">
                    <label>ì˜¤ë¥¸ìª½ ì´ˆê¸° ì˜¨ë„ T<sub>R0</sub></label>
                    <input id="TR0Input" type="range" min="0.2" max="5.0" step="0.1" value="1.0" />
                    <span class="stat" id="TR0Label">1.0</span>
                  </div>
                </div>
                <div class="row" style="justify-content:flex-end">
                  <button id="applyTemps">ì˜¨ë„ ìŠ¬ë¼ì´ë” ì ìš©</button>
                </div>
                <div class="small">ìŠ¬ë¼ì´ë”ë¥¼ ë°”ê¾¸ê³  "ì˜¨ë„ ìŠ¬ë¼ì´ë” ì ìš©"ì„ ëˆ„ë¥´ë©´ í˜„ì¬ ê° ì¹¸ì˜ ì†ë„ ë¶„í¬ë¥¼ í•´ë‹¹ ëª©í‘œ ì˜¨ë„ë¡œ <strong>ì¬ê°€ì—´/ëƒ‰ê°(ìŠ¤ì¼€ì¼ë§)</strong> í•©ë‹ˆë‹¤. ë¦¬ì…‹ ì‹œì—ë„ ìŠ¬ë¼ì´ë” ê°’ì´ ì´ˆê¸° ì¡°ê±´ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
              </div>

              <div class="card2">
                <div class="row" style="justify-content:space-between">
                  <div class="row">
                    <label>ì…ì(ê° ìƒ‰)</label>
                    <input id="nInput" type="range" min="20" max="200" step="10" value="80" />
                    <span class="stat" id="nLabel">80</span>
                  </div>
                  <div class="row">
                    <label>ì†ë„ ë°°ìœ¨</label>
                    <input id="vInput" type="range" min="0.4" max="3.0" step="0.1" value="1.3" />
                    <span class="stat" id="vLabel">1.3</span>
                  </div>
                </div>
                <div class="row" style="justify-content:space-between; margin-top:8px">
                  <div class="row">
                    <label>ë¬¸ ë†’ì´(%)</label>
                    <input id="gInput" type="range" min="0" max="100" step="5" value="40" />
                  </div>
                  <div class="row">
                    <label>ë¬¸ í­</label>
                    <input id="gwInput" type="range" min="4" max="20" step="1" value="8" />
                    <span class="stat" id="gwLabel">8px</span>
                  </div>
                </div>
                <div class="small" style="margin-top:6px">ë¬¸ì´ ì‘ì„ìˆ˜ë¡(ê°œêµ¬ìœ¨â†“) í™•ì‚°ì´ ëŠë ¤ì§‘ë‹ˆë‹¤ â†’ ì—”íŠ¸ë¡œí”¼ ì¦ê°€ê°€ ì²œì²œíˆ ì§„í–‰ë©ë‹ˆë‹¤.</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script>
      (() => {
        function buildLogFact(maxN) { const lf = new Float64Array(maxN+1); lf[0]=0; for(let i=1;i<=maxN;i++) lf[i]=lf[i-1]+Math.log(i); return lf; }
        function lnChoose(n,k,lf){ if(k<0||k>n) return -Infinity; return lf[n]-lf[k]-lf[n-k]; }
        function randn(){ let u=0, v=0; while(u===0) u=Math.random(); while(v===0) v=Math.random(); return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v); }

        const sim = document.getElementById('sim');
        const ctx = sim.getContext('2d');
        const chart = document.getElementById('chart');
        const cctx = chart.getContext('2d');

        const W = sim.width, H = sim.height; const midX = W/2;
        let gatePct = 40; let gateWidth = 8; const radius = 3.2;
        let speedScale = 1.3; let NperColor = 80; let running = true;

        const rL = document.getElementById('rLeft'); const rR = document.getElementById('rRight');
        const bL = document.getElementById('bLeft'); const bR = document.getElementById('bRight');
        const Sspan = document.getElementById('Snow'); const meter = document.getElementById('meter');
        const gatePercSpan = document.getElementById('gatePerc'); const gwLabel = document.getElementById('gwLabel');

        const TLspan = document.getElementById('TL'); const TRspan = document.getElementById('TR');
        const SQspan = document.getElementById('SQ'); const QLspan = document.getElementById('QL'); const QRspan = document.getElementById('QR');

        const TL0Input = document.getElementById('TL0Input'); const TR0Input = document.getElementById('TR0Input');
        const TL0Label = document.getElementById('TL0Label'); const TR0Label = document.getElementById('TR0Label');
        const applyTempsBtn = document.getElementById('applyTemps');

        const nInput = document.getElementById('nInput'); const vInput = document.getElementById('vInput');
        const gInput = document.getElementById('gInput'); const gwInput = document.getElementById('gwInput');
        const nLabel = document.getElementById('nLabel');

        document.getElementById('toggle').onclick = () => { running=!running; }
        document.getElementById('reset').onclick = resetAll;
        nInput.oninput = (e)=>{ NperColor = +e.target.value; nLabel.textContent = NperColor; resetAll(); }
        vInput.oninput = (e)=>{ speedScale = +e.target.value; document.getElementById('vLabel').textContent = speedScale.toFixed(1); }
        gInput.oninput = (e)=>{ gatePct = +e.target.value; gatePercSpan.textContent = gatePct; }
        gwInput.oninput = (e)=>{ gateWidth = +e.target.value; gwLabel.textContent = gateWidth+"px"; }
        TL0Input.oninput = ()=>{ TL0Label.textContent = (+TL0Input.value).toFixed(1); };
        TR0Input.oninput = ()=>{ TR0Label.textContent = (+TR0Input.value).toFixed(1); };
        applyTempsBtn.onclick = ()=>{ rethermalize('L', +TL0Input.value); rethermalize('R', +TR0Input.value); };

        let particles = [];
        let logFact = buildLogFact(20000);
        let maxLogW = 0; const kB = 1;
        let QL = 0, QR = 0, SQ = 0;

        function initParticles() {
          particles = [];
          for(let i=0;i<NperColor;i++) particles.push(makeParticle(true));
          for(let i=0;i<NperColor;i++) particles.push(makeParticle(false));
          const lnWmaxRed = lnChoose(NperColor, Math.floor(NperColor/2), logFact);
          const lnWmaxBlue = lnChoose(NperColor, Math.floor(NperColor/2), logFact);
          maxLogW = lnWmaxRed + lnWmaxBlue;
          history = []; t = 0; QL = 0; QR = 0; SQ = 0;
          rethermalize('L', +TL0Input.value);
          rethermalize('R', +TR0Input.value);
        }
        function makeParticle(isRed){
          let x, y;
          if(isRed) { x = Math.random()*(midX - 2*radius) + radius; } else { x = Math.random()*(midX - 2*radius) + midX + radius; }
          y = Math.random()*(H - 2*radius) + radius;
          let vx = randn(), vy = randn();
          return {x,y,vx,vy, red:isRed};
        }
        function rethermalize(side, Ttarget){
          const leftSide = (side==='L');
          let count=0, sumKE=0;
          for(const p of particles){ const isLeft = p.x < midX; if((leftSide && isLeft) || (!leftSide && !isLeft)){ count++; sumKE += 0.5*(p.vx*p.vx + p.vy*p.vy); } }
          if(count===0) return; let Tcurr = sumKE / count; if(!isFinite(Tcurr) || Tcurr<=0) Tcurr = 1e-6;
          const s = Math.sqrt(Ttarget / Tcurr);
          for(const p of particles){ const isLeft = p.x < midX; if((leftSide && isLeft) || (!leftSide && !isLeft)){ p.vx *= s; p.vy *= s; } }
        }
        function entropyNow(){
          let rLcount=0, bLcount=0, leftCount=0, rightCount=0, sumKEL=0, sumKER=0;
          for(const p of particles){ const left = (p.x < midX); const KE = 0.5*(p.vx*p.vx + p.vy*p.vy); if(left){ leftCount++; sumKEL += KE; if(p.red) rLcount++; else bLcount++; } else { rightCount++; sumKER += KE; } }
          const rRcount = NperColor - rLcount; const bRcount = NperColor - bLcount; rL.textContent = rLcount; rR.textContent = rRcount; bL.textContent = bLcount; bR.textContent = bRcount;
          const lnW = lnChoose(NperColor, rLcount, logFact) + lnChoose(NperColor, bLcount, logFact);
          const S = kB * lnW; const Smax = kB * maxLogW; const Snorm = Math.max(0, Math.min(1, S / Smax));
          Sspan.textContent = Snorm.toFixed(3); meter.style.width = (Snorm*100).toFixed(1)+"%";
          const TL = leftCount>0 ? (sumKEL/leftCount) : 0; const TR = rightCount>0 ? (sumKER/rightCount) : 0;
          TLspan.textContent = TL.toFixed(3); TRspan.textContent = TR.toFixed(3);
          SQspan.textContent = SQ.toFixed(3); QLspan.textContent = QL.toFixed(3); QRspan.textContent = QR.toFixed(3);
          return Snorm;
        }
        function step(dt){
          const openHalf = (gatePct/100) * (H/2); const gateTop = H/2 - openHalf, gateBot = H/2 + openHalf;
          for(const p of particles){
            const prevLeft = (p.x < midX);
            p.x += p.vx * speedScale * dt; p.y += p.vy * speedScale * dt;
            if(p.y < radius){ p.y = radius; p.vy *= -1; } else if(p.y > H - radius) { p.y = H - radius; p.vy *= -1; }
            if(p.x < radius){ p.x = radius; p.vx *= -1; } else if(p.x > W - radius){ p.x = W - radius; p.vx *= -1; }
            const nearWall = Math.abs(p.x - midX) <= (gateWidth/2 + radius);
            const withinGate = (p.y >= gateTop && p.y <= gateBot);
            if(nearWall){ if(!withinGate){ if(p.x < midX) { p.x = midX - (gateWidth/2 + radius); } else { p.x = midX + (gateWidth/2 + radius); } p.vx *= -1; } }
            const nowLeft = (p.x < midX);
            if(withinGate && (prevLeft !== nowLeft)){
              const KE = 0.5*(p.vx*p.vx + p.vy*p.vy);
              let lCount=0,rCount=0,sumL=0,sumR=0; for(const q of particles){ const left = (q.x < midX); const ke = 0.5*(q.vx*q.vx + q.vy*q.vy); if(left){ lCount++; sumL+=ke; } else { rCount++; sumR+=ke; } }
              const TL = lCount? (sumL/lCount) : 1e-6; const TR = rCount? (sumR/rCount) : 1e-6;
              if(prevLeft && !nowLeft){ QL -= KE; QR += KE; SQ += (-KE)/TL + (KE)/TR; }
              else if(!prevLeft && nowLeft){ QR -= KE; QL += KE; SQ += (-KE)/TR + (KE)/TL; }
            }
          }
        }
        function draw(){
          ctx.clearRect(0,0,W,H); ctx.fillStyle = '#0b0e1a'; ctx.fillRect(0,0,W,H);
          const openHalf = (gatePct/100) * (H/2); const gateTop = H/2 - openHalf, gateBot = H/2 + openHalf;
          ctx.fillStyle = '#263055'; ctx.fillRect(midX - gateWidth/2, 0, gateWidth, gateTop); ctx.fillRect(midX - gateWidth/2, gateBot, gateWidth, H-gateBot);
          const grad = ctx.createLinearGradient(midX-8, 0, midX+8, 0); grad.addColorStop(0, 'rgba(120,168,255,0)'); grad.addColorStop(0.5, 'rgba(120,168,255,0.22)'); grad.addColorStop(1, 'rgba(120,168,255,0)'); ctx.fillStyle = grad; ctx.fillRect(midX-12, gateTop, 24, gateBot-gateTop);
          for(const p of particles){ ctx.beginPath(); ctx.arc(p.x, p.y, radius, 0, 2*Math.PI); ctx.fillStyle = p.red ? 'rgba(255,77,77,0.95)' : 'rgba(77,155,255,0.95)'; ctx.fill(); }
        }
        let history = []; let t = 0;
        function drawChart(){
          const padding = 28; const w = chart.width, h = chart.height; cctx.clearRect(0,0,w,h);
          cctx.strokeStyle = '#32406f'; cctx.lineWidth = 1; cctx.beginPath(); cctx.moveTo(padding, h - padding); cctx.lineTo(w - padding, h - padding); cctx.moveTo(padding, h - padding); cctx.lineTo(padding, padding); cctx.stroke();
          cctx.fillStyle = '#9aa0b4'; cctx.font = '12px ui-sans-serif';
          [0,0.5,1].forEach(v => { const y = (h - padding) - v*(h - 2*padding); cctx.fillText(v.toFixed(1), 6, y+4); cctx.strokeStyle = 'rgba(154,160,180,0.12)'; cctx.beginPath(); cctx.moveTo(padding, y); cctx.lineTo(w - padding, y); cctx.stroke(); });
          if(history.length<2) return; const tMin = history[0][0]; const tMax = history[history.length-1][0];
          const xFor = (tt)=> padding + (tt - tMin) / Math.max(1e-6, (tMax - tMin)) * (w - 2*padding);
          const yFor = (s)=> (h - padding) - s*(h - 2*padding);
          cctx.lineWidth = 2; cctx.strokeStyle = '#51d19a'; cctx.beginPath(); cctx.moveTo(xFor(history[0][0]), yFor(history[0][1])); history.forEach(([tt, ss])=> cctx.lineTo(xFor(tt), yFor(ss))); cctx.stroke();
        }
        let last= performance.now();
        function loop(now){
          const dt = Math.min(0.033, (now-last)/16); last = now; if(running){ step(dt); }
          const s = entropyNow(); if(history.length===0 || (t - history[history.length-1][0])>0.05){ history.push([t, s]); if(history.length>1200) history.shift(); }
          draw(); drawChart(); if(running) t += dt*0.016*60; requestAnimationFrame(loop);
        }
        function resetAll(){ initParticles(); }
        // boot
        document.getElementById('TL0Label').textContent = (+document.getElementById('TL0Input').value).toFixed(1);
        document.getElementById('TR0Label').textContent = (+document.getElementById('TR0Input').value).toFixed(1);
        resetAll(); requestAnimationFrame(loop);
      })();
      </script>
    </section>

    <div class="pagebar" role="navigation" aria-label="í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜">
      <button id="prevPage">â† ì´ì „</button>
      <div class="dots" aria-hidden="true">
        <span class="dot" data-index="0"></span>
        <span class="dot" data-index="1"></span>
        <span class="dot" data-index="2"></span>
      </div>
      <span class="pagecount" id="pageCounter">1 / 3</span>
      <button id="nextPage">ë‹¤ìŒ â†’</button>
    </div>
  </main>

  <script>
    const pages = [document.getElementById('page-cover'), document.getElementById('page-intro'), document.getElementById('page-sim')];
    let currentPage = 0;
    const prevPageBtn = document.getElementById('prevPage');
    const nextPageBtn = document.getElementById('nextPage');
    const startBtn = document.getElementById('startBtn');
    const pageCounter = document.getElementById('pageCounter');
    function updateDots(){ document.querySelectorAll('.dot').forEach(dot=> dot.classList.toggle('active', parseInt(dot.dataset.index,10)===currentPage)); }
    function showPage(i){ currentPage = Math.max(0, Math.min(pages.length-1, i)); pages.forEach((sec, idx)=> sec.classList.toggle('active', idx===currentPage)); prevPageBtn.disabled = currentPage===0; nextPageBtn.disabled = currentPage===pages.length-1; if(pageCounter) pageCounter.textContent = (currentPage+1)+' / '+pages.length; const ids=['page-cover','page-intro','page-sim']; history.replaceState(null, '', '#'+ids[currentPage]); updateDots(); }
    prevPageBtn.addEventListener('click', ()=> showPage(currentPage-1));
    nextPageBtn.addEventListener('click', ()=> showPage(currentPage+1));
    if(startBtn) startBtn.addEventListener('click', ()=> showPage(1));
    document.querySelectorAll('a[data-goto]').forEach(a=> a.addEventListener('click', (e)=>{ const idx=parseInt(a.dataset.goto,10); if(!isNaN(idx)){ e.preventDefault(); showPage(idx); } }));
    window.addEventListener('keydown', (e)=>{ if(e.key==='ArrowRight') showPage(currentPage+1); else if(e.key==='ArrowLeft') showPage(currentPage-1); });
    const hashMap = { '#page-cover':0, '#page-intro':1, '#page-sim':2 }; const idx0 = hashMap[location.hash] ?? 0; showPage(idx0);
  </script>
</body>
</html>
""")

# Create a ZIP for downloading
zip_path = "/mnt/data/entropylab-clean.zip"
with zipfile.ZipFile(zip_path, "w", zipfile.ZIP_DEFLATED) as z:
    z.write(index_path, arcname="index.html")

zip_path
