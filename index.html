<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EntropyLab Â· ì—”íŠ¸ë¡œí”¼ ì‹œë®¬ë ˆì´ì…˜</title>
  <meta name="description" content="ë¹¨ê°„/íŒŒë€ ì…ì í˜¼í•©ê³¼ ì—´ ì´ë™ìœ¼ë¡œ ì—”íŠ¸ë¡œí”¼ ë³€í™”ë¥¼ ì§ê´€ì ìœ¼ë¡œ ì‹œê°í™”í•˜ëŠ” ì›¹ ì‹œë®¬ë ˆì´í„° í…œí”Œë¦¿.">
  <meta name="theme-color" content="#0f172a">
  <!-- Open Graph -->
  <meta property="og:title" content="EntropyLab Â· ì—”íŠ¸ë¡œí”¼ ì‹œë®¬ë ˆì´ì…˜">
  <meta property="og:description" content="ë¹¨ê°„/íŒŒë€ ì…ì í˜¼í•©ê³¼ ì—´ ì´ë™ìœ¼ë¡œ ì—”íŠ¸ë¡œí”¼ ë³€í™”ë¥¼ ì‹œê°í™”.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="">
  <style>
    :root{
      --bg: #0b1020; /* slate-950 */
      --panel: #0f172a; /* slate-900 */
      --muted: #94a3b8; /* slate-400 */
      --text: #e2e8f0; /* slate-200 */
      --accent: #22d3ee; /* cyan-400 */
      --accent-2: #a78bfa; /* violet-400 */
      --danger: #fb7185; /* rose-400 */
      --ok: #4ade80;    /* green-400 */
      --grid: #1f2937;  /* slate-800 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, #0a0f1e, #0e1530); color:var(--text);
      font: 15px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Noto Sans", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    header{
      position:sticky; top:0; z-index:20; background:rgba(11,16,32,.75); backdrop-filter:saturate(160%) blur(10px);
      border-bottom:1px solid #1f2937;
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px}
    .brand{display:flex; align-items:center; gap:12px; font-weight:700}
    .logo{width:28px; aspect-ratio:1; border-radius:8px; background:conic-gradient(from 0deg, #ef4444, #3b82f6, #22d3ee, #a78bfa, #ef4444); box-shadow:0 0 16px #22d3ee55 inset}
    nav{display:flex; gap:14px; margin-left:auto}
    nav a{color:var(--muted); text-decoration:none; padding:6px 10px; border-radius:8px}
    nav a:hover{background:#111827; color:var(--text)}

    main{padding:24px 16px}
    .grid{display:grid; grid-template-columns: 1.2fr .8fr; gap:18px}
    @media (max-width: 960px){ .grid{grid-template-columns:1fr} }

    .card{background:linear-gradient(180deg, #0b1120, #0a1226); border:1px solid #111827; border-radius:16px; box-shadow:0 10px 30px 0 rgba(0,0,0,.35)}
    .card h2{font-size:18px; margin:0 0 8px}
    .card .inner{padding:16px}

    .sim-wrap{padding:12px}
    .canvas-frame{position:relative; background:#020617; border:1px solid #111827; border-radius:14px; overflow:hidden}
    canvas{display:block; width:100%; height:auto; background:repeating-linear-gradient( to bottom, #0b1226, #0b1226 12px, #0a132b 12px, #0a132b 24px)}
    .statusbar{display:flex; flex-wrap:wrap; gap:10px; align-items:center; padding:10px 12px; background:#0b1226; border-top:1px solid #111827}
    .pill{padding:6px 10px; border:1px solid #1f2937; border-radius:999px; background:#0b1326; color:var(--muted)}

    .controls{display:grid; gap:12px}
    .control{display:grid; gap:6px}
    .control label{font-weight:600; color:#cbd5e1}
    .control .row{display:flex; align-items:center; gap:10px}
    input[type=range]{width:100%}
    .kbd{font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco; color:#cbd5e1; background:#0b1226; border:1px solid #1f2937; padding:2px 6px; border-radius:6px}

    .btns{display:flex; flex-wrap:wrap; gap:10px}
    button{
      cursor:pointer; border:1px solid #1f2937; background:#0b1226; color:var(--text); padding:10px 12px; border-radius:12px; font-weight:600
    }
    button.primary{background:linear-gradient(180deg, #0f172a, #0b1226); border-color:#233045; box-shadow:0 8px 20px rgba(34,211,238,.12)}
    button:hover{filter:brightness(1.1)}
    button:disabled{opacity:.5; cursor:not-allowed}

    footer{padding:24px 16px; color:var(--muted)}
    .muted{color:var(--muted)}
    .tiny{font-size:12px}
    .row{display:flex; gap:8px; align-items:center}
    .grow{flex:1}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    .success{color:var(--ok)}
    .danger{color:var(--danger)}
  .page{display:none}
.page.active{display:block}
.pagebar{position:sticky; bottom:12px; margin-top:16px; display:flex; justify-content:space-between; align-items:center; gap:12px; background:rgba(11,16,32,.75); border:1px solid #111827; border-radius:12px; padding:8px 12px; backdrop-filter:saturate(160%) blur(10px)}
.pagebar button{border-radius:10px}
.dots{display:flex; gap:8px}
.dot{width:8px; height:8px; border-radius:50%; background:#1f2937; display:inline-block}
.dot.active{background:#22d3ee}
.page{display:none; opacity:0; transform:translateY(6px); transition:opacity .25s ease, transform .25s ease}
.page.active{display:block; opacity:1; transform:none}
.pagebar{position:sticky; bottom:12px; margin-top:16px; display:flex; justify-content:space-between; align-items:center; gap:12px; background:rgba(11,16,32,.75); border:1px solid #111827; border-radius:12px; padding:8px 12px; backdrop-filter:saturate(160%) blur(10px)}
.pagebar button{border-radius:10px}
.dots{display:flex; gap:8px}
.dot{width:8px; height:8px; border-radius:50%; background:#1f2937; display:inline-block}
.dot.active{background:#22d3ee}
.pagecount{font:12px; color:var(--muted)}

/* Light theme */
:root[data-theme="light"]{
  --bg:#f8fafc; --panel:#ffffff; --muted:#475569; --text:#0f172a; --accent:#06b6d4; --accent-2:#7c3aed; --danger:#dc2626; --ok:#16a34a; --grid:#e2e8f0;
}
:root[data-theme="light"] body{background:linear-gradient(180deg,#f1f5f9,#e2e8f0)}
:root[data-theme="light"] .card{background:linear-gradient(180deg,#ffffff,#f8fafc); border-color:#e2e8f0}
:root[data-theme="light"] .canvas-frame{background:#f8fafc; border-color:#e2e8f0}
:root[data-theme="light"] .statusbar{background:#f1f5f9; border-color:#e2e8f0}
</style>
</head>
<body>
  <header>
    <div class="wrap row">
      <div class="brand"><div class="logo" aria-hidden></div>EntropyLab</div>
      <nav>
        <a href="#page-cover" data-goto="0">í‘œì§€</a>
        <a href="#page-intro" data-goto="1">ì†Œê°œ</a>
        <a href="#page-sim" data-goto="2">ì‹œë®¬ë ˆì´í„°</a>
        <button id="themeToggle" class="kbd" style="margin-left:8px" title="í…Œë§ˆ ì „í™˜">ğŸŒ— í…Œë§ˆ</button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- Page 0: COVER -->
    <section class="card page" id="page-cover" aria-label="í‘œì§€">
      <div class="inner">
        <h1 style="margin:0 0 6px;font-size:28px">EntropyLab</h1>
        <p class="muted" style="margin-top:0">ì—”íŠ¸ë¡œí”¼ë¥¼ <strong>ì§ê´€</strong>ê³¼ <strong>ì‹œë®¬ë ˆì´ì…˜</strong>ìœ¼ë¡œ ë°°ìš°ëŠ” ì‘ì€ ì‹¤í—˜ì‹¤</p>
        <div class="row" style="margin-top:12px; gap:12px; flex-wrap:wrap">
          <button class="primary" id="startBtn">ì‹œì‘í•˜ê¸° â†’</button>
          <a class="kbd" href="#page-intro" data-goto="1" role="button">ê°œë… ì†Œê°œ ë³´ê¸°</a>
        </div>
      </div>
      <div class="inner">
        <ul class="muted">
          <li>ë‘ êµ¬íš, ì¤‘ì•™ ë§‰, ì˜¨ë„ì°¨(í‰ê·  ì†ë„)ë¡œ í˜¼í•© ê³¼ì •ì„ ê´€ì°°</li>
          <li>ì •ê·œí™”ëœ Shannon í˜¼í•© ì—”íŠ¸ë¡œí”¼ë¡œ ìƒíƒœë¥¼ ìˆ˜ì¹˜í™”</li>
          <li>PNG ìŠ¤ëƒ…ìƒ· ì €ì¥, ë°˜ì‘í˜• UI, ì ‘ê·¼ì„± ë¼ë²¨</li>
        </ul>
      </div>
    </section>

    <!-- Page 1: INTRO -->
    <section class="card page" id="page-intro" aria-label="ì—”íŠ¸ë¡œí”¼ ì†Œê°œ">
      <div class="inner">
        <h2>ì—”íŠ¸ë¡œí”¼ í•œëˆˆì— ë³´ê¸°</h2>
        <p class="muted">ê°™ì€ ë‹¨ì–´ë¼ë„ ë§¥ë½ì— ë”°ë¼ ì˜ë¯¸ê°€ ì¡°ê¸ˆì”© ë‹¬ë¼ìš”. ì„¸ ê°€ì§€ ê´€ì ìœ¼ë¡œ ê°„ë‹¨íˆ ì •ë¦¬í•˜ê³ , ì•„ë˜ì— <strong>H(p) ë¯¸ë‹ˆ ë°ëª¨</strong>ë„ ë„£ì—ˆìŠµë‹ˆë‹¤.</p>
      </div>
      <div class="inner">
        <h3>â‘  ì •ë³´ ì—”íŠ¸ë¡œí”¼ (Information entropy)</h3>
        <p class="muted">ë¶ˆí™•ì‹¤ì„±/í‰ê·  ì •ë³´ëŸ‰ <span class="mono">H = - Î£ p_i Â· logâ‚‚ p_i</span> (ë‹¨ìœ„: bit). ë™ì¼í™•ë¥ ì¼ ë•Œ ìµœëŒ€.</p>
        <ul>
          <li>ì˜ˆ) ë™ì „: <span class="mono">p(ì•)=p(ë’¤)=0.5</span> â†’ <span class="mono">H=1 bit</span></li>
          <li>ì˜ˆ) ì¹˜ìš°ì¹œ ë™ì „: <span class="mono">p=0.9</span> â†’ <span class="mono">Hâ‰ˆ0.47 bit</span></li>
        </ul>
      </div>
      <div class="inner">
        <h3>â‘¡ ì—´ì—­í•™ì  ì—”íŠ¸ë¡œí”¼ (Thermodynamic entropy)</h3>
        <p class="muted">ê°€ì—­ ì—´êµí™˜ì˜ ì ë¶„ <span class="mono">Î”S = âˆ« Î´Q_rev/T</span> (ë‹¨ìœ„: J/K).</p>
        <ul>
          <li>ììœ íŒ½ì°½: ì™¸ë¶€ ì¼ ì—†ì´ ë¶€í”¼ê°€ ëŠ˜ë©´ <em>ë¯¸ì‹œìƒíƒœ ìˆ˜</em>ê°€ í¬ê²Œ ì¦ê°€ â†’ S ì¦ê°€</li>
          <li>ì œ2ë²•ì¹™: ê³ ë¦½ê³„ì—ì„œëŠ” <span class="mono">Î”S â‰¥ 0</span></li>
        </ul>
      </div>
      <div class="inner">
        <h3>â‘¢ í†µê³„ì  ì—”íŠ¸ë¡œí”¼ (Statistical entropy)</h3>
        <p class="muted"><span class="mono">S = k_B ln Î©</span>. ê°€ëŠ¥ ë°°ì¹˜ ìˆ˜ <span class="mono">Î©</span>ì˜ ë¡œê·¸. ë™ì¼í™•ë¥ ì´ë©´ <span class="mono">H = S / (k_B ln 2)</span>.</p>
        <ul>
          <li>ë™ì „ Nê°œì˜ ì•ë©´ kê°œ ë°°ì¹˜ëŠ” <span class="mono">Î© = C(N,k)</span></li>
        </ul>
      </div>
      <div class="inner">
        <h3 style="margin-bottom:8px">ë¯¸ë‹ˆ ë°ëª¨: H(p) ê³¡ì„ </h3>
        <p class="muted">ìŠ¬ë¼ì´ë”ë¡œ <span class="mono">p</span>(ì™¼ìª½ ì ìœ /í™•ë¥ )ë¥¼ ì¡°ì ˆí•˜ë©´ <span class="mono">H(p)=-[p logâ‚‚ p + (1-p) logâ‚‚(1-p)]</span>ê°€ ì–´ë–»ê²Œ ë°”ë€ŒëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”.</p>
        <div class="row" style="gap:12px; align-items:center">
          <input id="pDemo" type="range" min="0.0" max="1.0" step="0.01" value="0.5" style="width:280px">
          <span class="kbd">p=<span id="pDemoVal">0.50</span></span>
          <span class="kbd">H(p)=<span id="HDemoVal">1.000</span> bit</span>
          <button id="pDemoReset">ì¤‘ì•™(0.5)</button>
        </div>
        <div class="canvas-frame" style="margin-top:10px">
          <canvas id="entropyChart" width="900" height="220" aria-label="H(p) ì°¨íŠ¸"></canvas>
        </div>
      </div>
      <div class="inner">
        <p class="muted">ìš°ë¦¬ ì‹œë®¬ë ˆì´í„°(ë‹¤ìŒ í˜ì´ì§€)ëŠ” ê³µê°„ì„ ì¢Œ/ìš°ë¡œ ë‚˜ëˆ  ì ìœ ë¹„ìœ¨ <span class="mono">p</span>ì—ì„œ ìœ ë„í•œ <strong>í˜¼í•© ì •ë³´ ì—”íŠ¸ë¡œí”¼</strong>ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
      </div>
    </section>

    <!-- Page 2: SIMULATOR -->
    <section class="card page" id="page-sim" aria-label="ì—”íŠ¸ë¡œí”¼ ì‹œë®¬ë ˆì´ì…˜">
      <div class="inner">
        <h2>ì—”íŠ¸ë¡œí”¼ í˜¼í•© ì‹œë®¬ë ˆì´ì…˜ <span class="muted tiny">(ë¹¨ê°•=Hot, íŒŒë‘=Cold)</span></h2>
        <p class="muted">ì¤‘ì•™ ë§‰ì„ ì—´ë©´ ë‘ êµ¬íšì˜ ì…ìê°€ ì„ì´ë©° í˜¼í•©ë„ì™€ ì—”íŠ¸ë¡œí”¼ê°€ ë³€í™”í•©ë‹ˆë‹¤. ì˜¨ë„ì°¨(=í‰ê·  ì†ë„ì°¨)ë¥¼ ì¡°ì ˆí•´ ì—´ íë¦„ íš¨ê³¼ë„ ë³¼ ìˆ˜ ìˆì–´ìš”.</p>
      </div>
      <div class="sim-wrap">
        <div class="canvas-frame">
          <canvas id="simCanvas" width="900" height="480" aria-label="í˜¼í•© ì‹œë®¬ë ˆì´ì…˜ ìº”ë²„ìŠ¤"></canvas>
          <div class="statusbar mono" role="status" aria-live="polite">
            <span class="pill">t=<span id="t">0.00</span>s</span>
            <span class="pill">left fraction p=<span id="p">1.00</span></span>
            <span class="pill">H<sub>norm</sub>=<span id="H">0.00</span></span>
            <span class="pill">N=<span id="N">300</span></span>
            <span class="pill">Î”T slider=<span id="dT">1.5</span></span>
            <span class="pill">barrier=<span id="barrierState" class="success">CLOSED</span></span>
          </div>
        </div>
      </div>
      <div class="inner">
        <div class="controls">
          <div class="control">
            <label for="count">ì…ì ê°œìˆ˜ <span class="muted">(N)</span></label>
            <div class="row">
              <input id="count" type="range" min="50" max="800" value="300" step="10">
              <span class="kbd" id="countLabel">300</span>
              <button id="resetCount">ì¬ìƒì„±</button>
            </div>
          </div>
          <div class="control">
            <label for="tempDiff">ì˜¨ë„ì°¨ (ì™¼ìª½=Hot, ì˜¤ë¥¸ìª½=Cold) <span class="muted">í‰ê·  ì†ë„ ìŠ¤ì¼€ì¼</span></label>
            <div class="row">
              <input id="tempDiff" type="range" min="0.5" max="3" value="1.5" step="0.1">
              <span class="kbd" id="tempLabel">1.5</span>
              <button id="equalize">ì–‘ìª½ ê°™ì€ ì˜¨ë„</button>
            </div>
          </div>
          <div class="control">
            <label for="speed">ì‹œë®¬ë ˆì´ì…˜ ì†ë„</label>
            <div class="row">
              <input id="speed" type="range" min="0.2" max="2.0" value="1.0" step="0.1">
              <span class="kbd" id="speedLabel">1.0x</span>
            </div>
          </div>
          <div class="control">
            <label>ë§‰ ì œì–´</label>
            <div class="btns">
              <button id="toggleBarrier" class="primary">ë§‰ ì—´ê¸° / ë‹«ê¸°</button>
              <button id="mixAll">ì¦‰ì‹œ í˜¼í•©</button>
            </div>
          </div>
          <div class="control">
            <label>ì¬ìƒ ì œì–´</label>
            <div class="btns">
              <button id="play" class="primary">â–¶ ì‹œì‘</button>
              <button id="pause">â¸ ì •ì§€</button>
              <button id="step">â­ í•œ í”„ë ˆì„</button>
              <button id="reset">â†º ì´ˆê¸°í™”</button>
              <button id="snapshot">ğŸ“· ìŠ¤ëƒ…ìƒ· ì €ì¥</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Pager Bar -->
    <div class="pagebar" role="navigation" aria-label="í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜">
      <button id="prevPage">â† ì´ì „</button>
      <div class="dots" aria-hidden="true">
        <span class="dot" data-index="0"></span>
        <span class="dot" data-index="1"></span>
        <span class="dot" data-index="2"></span>
      </div>
      <span class="pagecount" id="pageCounter">1 / 3</span>
      <button id="nextPage">ë‹¤ìŒ â†’</button>
    </div>
      <button id="nextPage">ë‹¤ìŒ â†’</button>
    </div>
  </main>

  <footer class="wrap tiny">
    <div>Â© <span id="year"></span> EntropyLab. MIT License.</div>
  </footer>

<script>
(()=>{
  // ====== Utility ======
  const rnd = (a,b)=> Math.random()*(b-a)+a;
  const clamp = (v, lo, hi)=> Math.max(lo, Math.min(hi, v));
  const kB = 1; // ì‹œê°í™” ì •ê·œí™” ìš©ë„ (ì ˆëŒ€ ë‹¨ìœ„ ì•„ë‹˜)

  // ====== Canvas & State ======
  const canvas = document.getElementById('simCanvas');
  const ctx = canvas.getContext('2d');
  const W = canvas.width; const H = canvas.height; const midX = W/2;
  let particles = []; // {x,y,vx,vy,r,color,side}
  let N = 300;
  let barrierClosed = true;
  let time = 0;
  let speedScale = 1.0;
  let playing = false;
  let dt = 1/60;
  const radius = 3.2;

  // Controls
  const $ = id=> document.getElementById(id);
  const tEl=$('t'), pEl=$('p'), HEl=$('H'), NEl=$('N'), dTEl=$('dT'), barrierState=$('barrierState');
  const count=$('count'), tempDiff=$('tempDiff'), speed=$('speed');
  const countLabel=$('countLabel'), tempLabel=$('tempLabel'), speedLabel=$('speedLabel');
  const resetCount=$('resetCount'), equalize=$('equalize');
  const toggleBarrier=$('toggleBarrier'), mixAll=$('mixAll');
  const playBtn=$('play'), pauseBtn=$('pause'), stepBtn=$('step'), resetBtn=$('reset'), snapshot=$('snapshot');

  // ====== Init ======
  function initParticles(){
    particles = [];
    const hotScale = parseFloat(tempDiff.value); // ì™¼ìª½ í‰ê·  ì†ë„ ë°°ìœ¨
    const coldScale = 1.0;                       // ì˜¤ë¥¸ìª½ ê¸°ì¤€
    const leftN = Math.floor(N/2), rightN = N-leftN;
    for(let i=0;i<leftN;i++){
      particles.push(makeParticle(rnd(radius, midX - radius), rnd(radius, H-radius), hotScale, 'hot'));
    }
    for(let i=0;i<rightN;i++){
      particles.push(makeParticle(rnd(midX+radius, W - radius), rnd(radius, H-radius), coldScale, 'cold'));
    }
    updateIndicators();
    draw(0);
  }

  function makeParticle(x,y, tempScale, tag){
    const theta = rnd(0, Math.PI*2);
    // ë§¥ìŠ¤ì›° ê·¼ì‚¬: ì†ë„ í¬ê¸° ~ tempScale * (1 + ë‚œìˆ˜)
    const base = 60; // í”½ì…€/ì´ˆ ê¸°ì¤€
    const vmag = base * tempScale * (0.5 + Math.random());
    return { x, y, vx: vmag*Math.cos(theta), vy: vmag*Math.sin(theta), r: radius, tag };
  }

  // ====== Physics Step ======
  function stepOnce(){
    const sdt = dt * speedScale;
    // ì´ë™
    for(const p of particles){
      p.x += p.vx * sdt;
      p.y += p.vy * sdt;
      // ë²½ ë°˜ì‚¬
      if(p.x < p.r){ p.x = p.r; p.vx *= -1; }
      if(p.x > W - p.r){ p.x = W - p.r; p.vx *= -1; }
      if(p.y < p.r){ p.y = p.r; p.vy *= -1; }
      if(p.y > H - p.r){ p.y = H - p.r; p.vy *= -1; }
      // ì¤‘ì•™ ë§‰ ì¶©ëŒ (ë‹«í˜ì¼ ë•Œë§Œ)
      if(barrierClosed){
        if(Math.abs(p.x - midX) < p.r){
          // ë§‰ì€ ë°”ë‹¥ë¶€í„° ì²œì¥ê¹Œì§€
          if(p.x < midX){ p.x = midX - p.r; }
          else { p.x = midX + p.r; }
          p.vx *= -1;
        }
      }
    }
    time += sdt;
  }

  // ====== Entropy (mixing) ======
  function calcMetrics(){
    let left=0; for(const p of particles){ if(p.x < midX) left++; }
    const p = particles.length? left/particles.length : 0;
    // Shannon í˜¼í•© ì—”íŠ¸ë¡œí”¼ (0~1)
    let Hn = 0;
    if(p>0 && p<1){ Hn = - (p*Math.log2(p) + (1-p)*Math.log2(1-p)); }
    Hn = Hn / 1; // ì´ë¯¸ log2 ê¸°ì¤€ì´ë¯€ë¡œ ìµœëŒ€ê°’=1
    return {p, Hn};
  }

  // ====== Render ======
  function draw(alpha=0){
    // ë°°ê²½
    ctx.clearRect(0,0,W,H);
    // êµ¬íš ë°°ê²½ ì‚´ì§ ê·¸ë¼ë°ì´ì…˜
    const g = ctx.createLinearGradient(0,0,W,0);
    g.addColorStop(0, '#0b1226');
    g.addColorStop(0.5, '#0b1226');
    g.addColorStop(0.5, '#0a0f20');
    g.addColorStop(1, '#0a0f20');
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

    // ì¤‘ì•™ ë§‰
    if(barrierClosed){
      ctx.fillStyle = '#334155';
      ctx.fillRect(midX-2, 0, 4, H);
    } else {
      // ì ì„ ë§Œ
      ctx.setLineDash([6,6]);
      ctx.strokeStyle = '#1f2937';
      ctx.beginPath(); ctx.moveTo(midX,0); ctx.lineTo(midX,H); ctx.stroke();
      ctx.setLineDash([]);
    }

    // ì…ì
    for(const p of particles){
      ctx.beginPath();
      ctx.fillStyle = (p.tag==='hot')? '#ef4444' : '#3b82f6';
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
    }

    // ê²©ì ëŠë‚Œ
    ctx.strokeStyle = '#0f1a33';
    ctx.lineWidth=1;
    for(let y=0;y<H;y+=24){ ctx.beginPath(); ctx.moveTo(0,y+.5); ctx.lineTo(W,y+.5); ctx.stroke(); }
  }

  // ====== UI Wiring ======
  function updateIndicators(){
    const {p, Hn} = calcMetrics();
    tEl.textContent = time.toFixed(2);
    pEl.textContent = p.toFixed(2);
    HEl.textContent = Hn.toFixed(3);
    NEl.textContent = String(N);
    dTEl.textContent = parseFloat(tempDiff.value).toFixed(1);
    barrierState.textContent = barrierClosed? 'CLOSED':'OPEN';
    barrierState.className = barrierClosed? 'success':'danger';
  }

  let rafId = null;
  function loop(){
    stepOnce();
    draw();
    updateIndicators();
    if(playing) rafId = requestAnimationFrame(loop);
  }

  // Controls: sliders
  count.addEventListener('input', ()=>{ N = parseInt(count.value,10); countLabel.textContent = String(N); });
  resetCount.addEventListener('click', ()=>{ initParticles(); });

  tempDiff.addEventListener('input', ()=>{
    tempLabel.textContent = parseFloat(tempDiff.value).toFixed(1);
    // ì˜¨ë„ì°¨ ì¦‰ì‹œ ë°˜ì˜: ì™¼ìª½ ì…ìë“¤ì˜ í‰ê·  ì†ë„ë§Œ ì¬ìŠ¤ì¼€ì¼
    const hotScale = parseFloat(tempDiff.value);
    for(const p of particles){ if(p.x < midX){ const s = hotScale; const th = Math.atan2(p.vy,p.vx); const speed = 60 * s * (0.5 + Math.random()); p.vx = speed*Math.cos(th); p.vy = speed*Math.sin(th); p.tag='hot'; } else { p.tag='cold'; } }
  });
  equalize.addEventListener('click',()=>{ tempDiff.value = 1.0; tempLabel.textContent = '1.0'; const s=1.0; for(const p of particles){ const th=Math.atan2(p.vy,p.vx); const speed = 60 * s * (0.5 + Math.random()); p.vx=speed*Math.cos(th); p.vy=speed*Math.sin(th); p.tag=(p.x<midX)?'hot':'cold'; } });

  speed.addEventListener('input', ()=>{ speedScale = parseFloat(speed.value); speedLabel.textContent = speedScale.toFixed(1)+'x'; });

  // Barrier & mix
  toggleBarrier.addEventListener('click', ()=>{ barrierClosed = !barrierClosed; updateIndicators(); });
  mixAll.addEventListener('click', ()=>{ barrierClosed = false; // ì¤‘ì•™ì„ ì—´ê³ , ë°˜ì”© ì˜¤ë¥¸ìª½/ì™¼ìª½ìœ¼ë¡œ ë¬´ì‘ìœ„ ì´ë™
    for(const p of particles){ p.x = rnd(radius, W - radius); }
    updateIndicators();
  });

  // Play controls
  playBtn.addEventListener('click', ()=>{ if(!playing){ playing=true; loop(); }});
  pauseBtn.addEventListener('click', ()=>{ playing=false; cancelAnimationFrame(rafId); });
  stepBtn.addEventListener('click', ()=>{ playing=false; cancelAnimationFrame(rafId); stepOnce(); draw(); updateIndicators(); });
  resetBtn.addEventListener('click', ()=>{ playing=false; cancelAnimationFrame(rafId); time=0; barrierClosed=true; initParticles(); updateIndicators(); });

  // Snapshot
  snapshot.addEventListener('click', ()=>{
    const url = canvas.toDataURL('image/png');
    const a = document.createElement('a');
    a.href = url; a.download = `entropylab_${Date.now()}.png`; a.click();
  });

  // Pager logic
  const pages = [
    document.getElementById('page-cover'),
    document.getElementById('page-intro'),
    document.getElementById('page-sim')
  ];
  let currentPage = 0;
  const prevPageBtn = document.getElementById('prevPage');
  const nextPageBtn = document.getElementById('nextPage');
  const startBtn = document.getElementById('startBtn');
  const pageCounter = document.getElementById('pageCounter');

  function updateDots(){
    document.querySelectorAll('.dot').forEach(dot=>{
      dot.classList.toggle('active', parseInt(dot.dataset.index,10)===currentPage);
    });
  }
  function showPage(i){
    currentPage = Math.max(0, Math.min(pages.length-1, i));
    pages.forEach((sec, idx)=>{ sec.classList.toggle('active', idx===currentPage); sec.setAttribute('aria-hidden', idx===currentPage? 'false':'true'); });
    prevPageBtn.disabled = currentPage===0;
    nextPageBtn.disabled = currentPage===pages.length-1;
    if(pageCounter) pageCounter.textContent = (currentPage+1)+' / '+pages.length;
    updateDots();
    const ids=['page-cover','page-intro','page-sim'];
    history.replaceState(null, '', '#'+ids[currentPage]);
  }

  prevPageBtn.addEventListener('click', ()=> showPage(currentPage-1));
  nextPageBtn.addEventListener('click', ()=> showPage(currentPage+1));
  if(startBtn) startBtn.addEventListener('click', ()=> showPage(1));
  document.querySelectorAll('a[data-goto]').forEach(a=> a.addEventListener('click', (e)=>{
    const idx=parseInt(a.dataset.goto,10); if(!isNaN(idx)){ e.preventDefault(); showPage(idx); }
  }));
  window.addEventListener('keydown', (e)=>{ if(e.key==='ArrowRight') showPage(currentPage+1); else if(e.key==='ArrowLeft') showPage(currentPage-1); });
  const hashMap = { '#page-cover':0, '#page-intro':1, '#page-sim':2 };
  const idx0 = hashMap[location.hash] ?? 0;

  // THEME toggle (persist)
  const themeBtn = document.getElementById('themeToggle');
  const savedTheme = localStorage.getItem('entropylab-theme');
  if(savedTheme){ document.documentElement.setAttribute('data-theme', savedTheme); }
  if(themeBtn){ themeBtn.addEventListener('click', ()=>{
    const cur = document.documentElement.getAttribute('data-theme') || 'dark';
    const next = (cur==='light')? 'dark':'light';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('entropylab-theme', next);
  }); }

  // MINI DEMO: H(p) chart
  const pDemo = document.getElementById('pDemo');
  const pDemoVal = document.getElementById('pDemoVal');
  const HDemoVal = document.getElementById('HDemoVal');
  const pDemoReset = document.getElementById('pDemoReset');
  const chart = document.getElementById('entropyChart');
  const cctx = chart? chart.getContext('2d') : null;

  function Hbin(p){
    if(p<=0 || p>=1) return 0;
    return - (p*Math.log2(p) + (1-p)*Math.log2(1-p));
  }
  function drawEntropyChart(){
    if(!cctx) return;
    const W = chart.width, H = chart.height;
    cctx.clearRect(0,0,W,H);
    // axes
    cctx.strokeStyle = '#1f2937'; cctx.lineWidth = 1;
    cctx.beginPath(); cctx.moveTo(40, H-30); cctx.lineTo(W-10, H-30); cctx.stroke();
    cctx.beginPath(); cctx.moveTo(40, H-30); cctx.lineTo(40, 10); cctx.stroke();
    // curve H(p)
    cctx.beginPath();
    for(let i=0;i<=200;i++){
      const p = i/200; const h = Hbin(p);
      const x = 40 + p*(W-60);
      const y = (H-30) - (h/1.0)*(H-50);
      if(i===0) cctx.moveTo(x,y); else cctx.lineTo(x,y);
    }
    cctx.strokeStyle = '#22d3ee'; cctx.lineWidth = 2; cctx.stroke();
    // tick labels
    cctx.fillStyle = '#94a3b8'; cctx.font = '12px ui-monospace, monospace';
    cctx.fillText('0', 38, H-12);
    cctx.fillText('1', W-18, H-12);
    cctx.fillText('H', 24, 16);
    // current p marker
    if(pDemo){
      const p = parseFloat(pDemo.value);
      const h = Hbin(p);
      const x = 40 + p*(W-60);
      const y = (H-30) - (h/1.0)*(H-50);
      cctx.beginPath(); cctx.arc(x,y,4,0,Math.PI*2); cctx.fillStyle = '#a78bfa'; cctx.fill();
    }
  }
  function updateDemo(){
    if(!pDemo) return; const p = parseFloat(pDemo.value);
    pDemoVal.textContent = p.toFixed(2);
    HDemoVal.textContent = Hbin(p).toFixed(3);
    drawEntropyChart();
  }
  if(pDemo){
    pDemo.addEventListener('input', updateDemo);
    if(pDemoReset){ pDemoReset.addEventListener('click', ()=>{ pDemo.value = 0.5; updateDemo(); }); }
  }

  // Original bootstrap
  document.getElementById('year').textContent = new Date().getFullYear();
  initParticles();
  draw(0);
  showPage(idx0);
  updateDemo();

})();
</script>
</body>
</html>
